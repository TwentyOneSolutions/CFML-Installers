<project>
    <shortName>openbd</shortName>
    <fullName>Open BlueDragon</fullName>
    <version>1.4-pl1</version>
    <installerFilename>${product_shortname}-${product_version}-${platform_name}-x64-installer.${platform_exec_suffix}</installerFilename>
    <leftImage>openbd-sidebar.png</leftImage>
    <logoImage>openbd_logo_icon_small.png</logoImage>
    <splashImage>openbd-splash.png</splashImage>
    <initializationActionList>
        <setInstallerVariable name="my_prefix" persist="1" value="${env(systemdrive)}\openbd">
            <ruleList>
                <platformTest type="windows"/>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable name="my_prefix" persist="1" value="/opt/openbd">
            <ruleList>
                <platformTest type="linux"/>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apachebinaryloc</name>
            <value>/usr/sbin/httpd</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apachecontrolloc</name>
            <value>/etc/init.d/httpd</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apachemodulesloc</name>
            <value>/usr/lib/httpd/modules/</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apachemodulesloc</name>
            <value>/usr/lib64/httpd/modules/</value>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apacheconfigloc</name>
            <value>/etc/httpd/conf/httpd.conf</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>apachelogloc</name>
            <value>/var/log/httpd/</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>installiis</name>
            <show>0</show>
            <value>no</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>bittype</name>
            <value>64</value>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>bittype</name>
            <value>32</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
                <platformTest>
                    <negate>1</negate>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>iis_version</name>
            <persist>1</persist>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <value>IIS7</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
                <fileExists>
                    <path>${windows_folder_systemroot}\system32\inetsrv\appcmd.exe</path>
                </fileExists>
                <registryTest>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\InetStp</key>
                    <logic>exists</logic>
                    <name>MajorVersion</name>
                </registryTest>
                <registryTest>
                    <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\InetStp\Components</key>
                    <logic>is_not_empty</logic>
                    <name>ISAPIFilter</name>
                </registryTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>iis_version</name>
            <persist>1</persist>
            <value>IIS6</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
                <fileExists>
                    <path>${env(SYSTEMDRIVE)}\inetpub\adminscripts\adsutil.vbs</path>
                </fileExists>
                <platformTest>
                    <type>windows-2003</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>iis_version</name>
            <persist>1</persist>
            <value>no</value>
            <ruleList>
                <stringTest>
                    <text>${iis_version}</text>
                    <type>empty</type>
                </stringTest>
            </ruleList>
        </setInstallerVariable>
    </initializationActionList>
    <compressionAlgorithm>lzma</compressionAlgorithm>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <installationLogFile>${installdir}/install.log</installationLogFile>
    <productDisplayIcon>${installdir}/openbd.ico</productDisplayIcon>
    <requireInstallationByRootUser>1</requireInstallationByRootUser>
    <saveRelativePaths>1</saveRelativePaths>
    <vendor>Vivio Technologies</vendor>
    <windowsExecutableIcon>openbd.ico</windowsExecutableIcon>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>openbd32-windows/bin</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/classes</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/customtags</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/lib</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/webresources</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>openbd.ico</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>openbd32-windows/conf</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-windows/jdk</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-windows/tomcat</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/connector</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-windows/bluedragon</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>openbd64-linux/bin</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/classes</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/conf</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/customtags</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd32-linux/jdk</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/lib</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/logs</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/sys</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/tomcat</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/tomcat_connectors</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/webresources</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/work</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>openbd64-linux/openbd_ctl</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>openbd.ico</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux64</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>openbd64-linux/bin</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/classes</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/conf</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/customtags</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/jdk</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/lib</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/logs</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/sys</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/tomcat</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/tomcat_connectors</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/webresources</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>openbd64-linux/work</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>openbd64-linux/openbd_ctl</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>openbd.ico</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
            </folderList>
            <postInstallationActionList>
                <substitute>
                    <encoding>utf-8</encoding>
                    <explanation>Creating Tomcat User's File</explanation>
                    <files>${installdir}/tomcat/conf/tomcat-users.xml</files>
                    <type>exact</type>
                    <substitutionList>
                        <substitution>
                            <pattern>@@myTomcatAdminUsername@@</pattern>
                            <value>${tomcatuser}</value>
                        </substitution>
                        <substitution>
                            <pattern>@@myTomcatAdminPassword@@</pattern>
                            <value>${tomcatpass}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <substitute>
                    <encoding>utf-8</encoding>
                    <explanation>Creating Control Sctipt</explanation>
                    <files>${installdir}/openbd_ctl</files>
                    <type>exact</type>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>@@installdir@@</pattern>
                            <value>${installdir}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <changePermissions>
                    <files>${installdir}/openbd_ctl</files>
                    <permissions>744</permissions>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </changePermissions>
                <addUnixService>
                    <description>Open BlueDragon Control Script</description>
                    <explanation>Installing Service</explanation>
                    <name>openbd_ctl</name>
                    <program>${installdir}/openbd_ctl</program>
                    <ruleList>
                        <isTrue>
                            <value>${startatboot}</value>
                        </isTrue>
                    </ruleList>
                </addUnixService>
                <substitute>
                    <encoding>utf-8</encoding>
                    <explanation>Updating Open BlueDragon Configuration</explanation>
                    <files>${installdir}/conf/bluedragon.xml</files>
                    <type>exact</type>
                    <substitutionList>
                        <substitution>
                            <pattern>@@myOpenBDAdminPassword@@</pattern>
                            <value>${openbdpass}</value>
                        </substitution>
                        <substitution>
                            <pattern>@@installdir@@</pattern>
                            <value>${'$'}${installdir}</value>
                            <ruleList>
                                <platformTest>
                                    <type>linux</type>
                                </platformTest>
                            </ruleList>
                        </substitution>
                        <substitution>
                            <pattern>@@installdir@@</pattern>
                            <value>${installdir}</value>
                            <ruleList>
                                <platformTest>
                                    <type>windows</type>
                                </platformTest>
                            </ruleList>
                        </substitution>
                    </substitutionList>
                </substitute>
                <actionGroup>
                    <explanation>installing 64-bit mod_jk</explanation>
                    <actionList>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/x86_64/mod_jk-1.2.28-httpd-1.3.X-eapi.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>13</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/x86_64/mod_jk-1.2.28-httpd-2.0.X.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>20</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/x86_64/mod_jk-1.2.28-httpd-2.2.X.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>22</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <createSymLink>
                            <linkName>${installdir}/sys/mod_jk.so</linkName>
                            <target>${apachemodulesloc}/mod_jk.so</target>
                        </createSymLink>
                        <deleteFile>
                            <path>${installdir}/tomcat_connectors/</path>
                        </deleteFile>
                    </actionList>
                    <ruleList>
                        <isTrue>
                            <value>${installconn}</value>
                        </isTrue>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${bittype}</value1>
                            <value2>64</value2>
                        </compareValues>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
                <actionGroup>
                    <explanation>installing 32-bit mod_jk</explanation>
                    <actionList>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/i386/mod_jk-1.2.28-httpd-1.3.X-eapi.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>13</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/i386/mod_jk-1.2.28-httpd-2.0.X.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>20</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <copyFile>
                            <destination>${apachemodulesloc}/mod_jk.so</destination>
                            <origin>${installdir}/tomcat_connectors/i386/mod_jk-1.2.28-httpd-2.2.X.so</origin>
                            <ruleList>
                                <compareValues>
                                    <logic>equals</logic>
                                    <value1>${apachever}</value1>
                                    <value2>22</value2>
                                </compareValues>
                            </ruleList>
                        </copyFile>
                        <createSymLink>
                            <linkName>${installdir}/sys/mod_jk.so</linkName>
                            <target>${apachemodulesloc}/mod_jk.so</target>
                        </createSymLink>
                        <deleteFile>
                            <path>${installdir}/tomcat_connectors/</path>
                        </deleteFile>
                    </actionList>
                    <ruleList>
                        <isTrue>
                            <value>${installconn}</value>
                        </isTrue>
                        <compareValues>
                            <logic>equals</logic>
                            <value1>${bittype}</value1>
                            <value2>32</value2>
                        </compareValues>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
                <actionGroup>
                    <explanation>Configuring Apache with mod_jk</explanation>
                    <actionList>
                        <addTextToFile>
                            <file>${apacheconfigloc}</file>
                            <text>&lt;IfModule !mod_jk.c&gt;
    LoadModule jk_module @@ApacheModulesDir@@/mod_jk.so
&lt;/IfModule&gt;

&lt;IfModule mod_jk.c&gt;
    JkMount /*.cfm ajp13
    JkMount /*.cfc ajp13
    JkMount /*.do ajp13
    JkMount /*.jsp ajp13
    JkMount /*.cfchart ajp13
    JkMount /*.cfres ajp13
    JkMount /*.cfm/* ajp13
    JkMount /*.cfml/* ajp13
    JkMountCopy all
    JkLogFile @@apachelogloc@@/mod_jk.log
&lt;/IfModule&gt;</text>
                        </addTextToFile>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${apacheconfigloc}</files>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@ApacheModulesDir@@</pattern>
                                    <value>${apachemodulesloc}</value>
                                </substitution>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                                <substitution>
                                    <pattern>@@apachelogloc@@</pattern>
                                    <value>${apachelogloc}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <createSymLink>
                            <linkName>${installdir}/sys/apache_ctl</linkName>
                            <target>${apachecontrolloc}</target>
                        </createSymLink>
                        <createSymLink>
                            <linkName>${installdir}/sys/httpd.conf</linkName>
                            <target>${apacheconfigloc}</target>
                        </createSymLink>
                        <runProgram>
                            <program>${apachecontrolloc}</program>
                            <programArguments>restart</programArguments>
                            <show>0</show>
                        </runProgram>
                    </actionList>
                    <ruleList>
                        <isTrue>
                            <value>${installconn}</value>
                        </isTrue>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
                <runProgram>
                    <program>${installdir}/openbd_ctl</program>
                    <programArguments>start</programArguments>
                    <show>0</show>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <actionGroup>
                    <explanation>Configuring OpenBD-Tomcat Service</explanation>
                    <progressText>Configuring OpenBD-Tomcat Service</progressText>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <actionList>
                        <runProgram>
                            <program>${installdir}\tomcat\bin\service.bat</program>
                            <programArguments>install OpenBD</programArguments>
                        </runProgram>
                        <registrySet>
                            <key>HKEY_LOCAL_MACHINE\SOFTWARE\Apache Software Foundation\Procrun 2.0\OpenBD\Parameters\Java</key>
                            <name>jvm</name>
                            <show>0</show>
                            <type>REG_SZ</type>
                            <value>${installdir}\jdk\jre\bin\server\jvm.dll</value>
                        </registrySet>
                        <runProgram>
                            <program>${installdir}\tomcat\bin\autostart.bat</program>
                            <programArguments></programArguments>
                            <show>0</show>
                            <ruleList>
                                <isTrue>
                                    <value>${startatboot}</value>
                                </isTrue>
                            </ruleList>
                        </runProgram>
                    </actionList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </actionGroup>
                <substitute>
                    <encoding>utf-8</encoding>
                    <explanation>Modifying Tomcat Port Number</explanation>
                    <files>${installdir}\tomcat\conf\server.xml</files>
                    <progressText>Modifying Tomcat Port Number</progressText>
                    <type>exact</type>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>@@tomcatport@@</pattern>
                            <value>${tomcatport}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <substitute>
                    <encoding>utf-8</encoding>
                    <explanation>Configuring Tomcat Port</explanation>
                    <files>${installdir}/tomcat/conf/server.xml</files>
                    <progressText>Configuring Tomcat Port</progressText>
                    <type>exact</type>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                    <substitutionList>
                        <substitution>
                            <pattern>@@tomcatport@@</pattern>
                            <value>${tomcatport}</value>
                        </substitution>
                    </substitutionList>
                </substitute>
                <actionGroup>
                    <explanation>Installing IIS7 Connector</explanation>
                    <progressText>Installing IIS7 Connector</progressText>
                    <show>0</show>
                    <actionList>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\iis7connect.bat</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\iis7remove.bat</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\isapi_redirect-1.2.30.properties</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <renameFile>
                            <customErrorMessage>Error renaming connector DLL.</customErrorMessage>
                            <destination>${installdir}\connector\isapi_redirect-1.2.30.dll</destination>
                            <origin>${installdir}\connector\isapi_redirect-1.2.30.32-bit.dll</origin>
                            <ruleList>
                                <platformTest>
                                    <negate>1</negate>
                                    <type>windows-x64</type>
                                </platformTest>
                            </ruleList>
                        </renameFile>
                        <renameFile>
                            <customErrorMessage>Error renaming connector DLL.</customErrorMessage>
                            <destination>${installdir}\connector\isapi_redirect-1.2.30.dll</destination>
                            <origin>${installdir}\connector\isapi_redirect-1.2.30.64-bit.dll</origin>
                            <ruleList>
                                <platformTest>
                                    <type>windows-x64</type>
                                </platformTest>
                            </ruleList>
                        </renameFile>
                        <runProgram>
                            <program>${installdir}\connector\iis7connect.bat</program>
                            <programArguments></programArguments>
                            <show>0</show>
                        </runProgram>
                    </actionList>
                    <onErrorActionList>
                        <showWarning>
                            <text>Error occurred trying to install IIS Connector. Additional detail about the error can be found in the installer logs.</text>
                        </showWarning>
                    </onErrorActionList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                        <isTrue>
                            <value>${installiis}</value>
                        </isTrue>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS7</value>
                        </compareText>
                    </ruleList>
                </actionGroup>
                <actionGroup>
                    <explanation>Installing IIS6 Connector</explanation>
                    <progressText>Installing IIS6 Connector</progressText>
                    <show>0</show>
                    <actionList>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\iis6connect.bat</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\iis6remove.bat</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <substitute>
                            <encoding>utf-8</encoding>
                            <files>${installdir}\connector\isapi_redirect-1.2.30.properties</files>
                            <show>0</show>
                            <type>exact</type>
                            <substitutionList>
                                <substitution>
                                    <pattern>@@installdir@@</pattern>
                                    <value>${installdir}</value>
                                </substitution>
                            </substitutionList>
                        </substitute>
                        <renameFile>
                            <customErrorMessage>Error renaming connector DLL.</customErrorMessage>
                            <destination>${installdir}\connector\isapi_redirect-1.2.30.dll</destination>
                            <origin>${installdir}\connector\isapi_redirect-1.2.30.32-bit.dll</origin>
                            <ruleList>
                                <platformTest>
                                    <negate>1</negate>
                                    <type>windows-x64</type>
                                </platformTest>
                            </ruleList>
                        </renameFile>
                        <renameFile>
                            <customErrorMessage>Error renaming connector DLL.</customErrorMessage>
                            <destination>${installdir}\connector\isapi_redirect-1.2.30.dll</destination>
                            <origin>${installdir}\connector\isapi_redirect-1.2.30.64-bit.dll</origin>
                            <ruleList>
                                <platformTest>
                                    <type>windows-x64</type>
                                </platformTest>
                            </ruleList>
                        </renameFile>
                        <runProgram>
                            <program>${installdir}\connector\iis6connect.bat</program>
                            <programArguments></programArguments>
                            <runAs>Administrator</runAs>
                            <show>0</show>
                            <useMSDOSPath>0</useMSDOSPath>
                        </runProgram>
                    </actionList>
                    <onErrorActionList>
                        <showWarning>
                            <text>Error occurred trying to install IIS Connector.

Additional detail about the error can be found in the installer log files located in the installation directory.</text>
                        </showWarning>
                    </onErrorActionList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                        <isTrue>
                            <value>${installiis}</value>
                        </isTrue>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS6</value>
                        </compareText>
                    </ruleList>
                </actionGroup>
                <startWindowsService>
                    <abortOnError>0</abortOnError>
                    <delay>15000</delay>
                    <displayName>Apache Tomcat OpenBD</displayName>
                    <explanation>Starting OpenBD-Tomcat Service</explanation>
                    <progressText>Starting OpenBD-Tomcat Service</progressText>
                    <serviceName>OpenBD</serviceName>
                </startWindowsService>
            </postInstallationActionList>
            <postUninstallationActionList>
                <removeUnixService>
                    <explanation>Removing Unix Service</explanation>
                    <name>openbd_ctl</name>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </removeUnixService>
            </postUninstallationActionList>
            <preUninstallationActionList>
                <getSymLinkTarget>
                    <link>${installer_directory}/sys/mod_jk.so</link>
                    <variable>modjklocation</variable>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </getSymLinkTarget>
                <deleteFile>
                    <path>${modjklocation}</path>
                    <ruleList>
                        <fileExists>
                            <path>${modjklocation}</path>
                        </fileExists>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </deleteFile>
                <getSymLinkTarget>
                    <link>${installer_directory}/sys/httpd.conf</link>
                    <variable>apacheconfigloc</variable>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </getSymLinkTarget>
                <runConsoleProgram>
                    <program>${installer_directory}/sys/remove_connector.sh</program>
                    <programArguments>${apacheconfigloc}</programArguments>
                    <show>0</show>
                    <ruleList>
                        <fileExists>
                            <path>${installer_directory}/sys/httpd.conf</path>
                        </fileExists>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </runConsoleProgram>
                <deleteFile>
                    <path>${installer_directory}/sys/httpd.conf</path>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </deleteFile>
                <runProgram>
                    <program>${installer_directory}/sys/apache_ctl</program>
                    <programArguments>restart</programArguments>
                    <show>0</show>
                    <ruleList>
                        <platformTest>
                            <type>linux</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <program>${installdir}\tomcat\bin\service.bat</program>
                    <programArguments>remove OpenBD</programArguments>
                    <show>0</show>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <explanation>Removing IIS7 Connector</explanation>
                    <program>${installdir}\connector\iis7remove.bat</program>
                    <programArguments></programArguments>
                    <progressText>Removing IIS7 Connector</progressText>
                    <show>0</show>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS7</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <explanation>Removing IIS6 Connector</explanation>
                    <program>${installdir}\connector\iis6remove.bat</program>
                    <programArguments></programArguments>
                    <progressText>Removing IIS6 Connector</progressText>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS6</value>
                        </compareText>
                    </ruleList>
                </runProgram>
            </preUninstallationActionList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Control Your OpenBD Service</comment>
                    <name>OpenBD-Tomcat Service Control</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}\tomcat\bin\openbdw.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}\openbd.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </startMenuShortcut>
                <startMenuShortcut>
                    <comment>Remove OpenBD From Your Computer</comment>
                    <name>Uninstall OpenBD</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}\uninstall.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}\openbd.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </startMenuShortcut>
                <startMenuLinkShortcut>
                    <comment>Launch the OpenBD Administrator</comment>
                    <name>OpenBD Administrator</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <url>http://localhost:${tomcatport}/bluedragon/administrator</url>
                    <windowsIcon>${installdir}\openbd.ico</windowsIcon>
                </startMenuLinkShortcut>
                <startMenuShortcut>
                    <comment>Turn On the OpenBD-Tomcat Service Monitor</comment>
                    <name>OpenBD-Tomcat Service Monitor</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}\tomcat\bin\openbdw.exe</windowsExec>
                    <windowsExecArgs>//MS//OpenBD</windowsExecArgs>
                    <windowsIcon>${installdir}\openbd.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </startMenuShortcut>
                <startMenuShortcut>
                    <comment>Add a new host entry to Tomcat's Config</comment>
                    <name>Tomcat Host Config</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>notepad</windowsExec>
                    <windowsExecArgs>${installdir}\tomcat\conf\server.xml</windowsExecArgs>
                    <windowsIcon>${installdir}\openbd.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
    </componentList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${my_prefix}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <width>30</width>
        </directoryParameter>
        <stringParameter>
            <name>tomcatuser</name>
            <title>Tomcat Administrator Username</title>
            <description>Tomcat Administrator Username</description>
            <explanation>Tomcat includes a web interface that can be used to manage some aspects of your Tomcat server. Please enter the username that you would like to use to access that web based administrator.</explanation>
            <value></value>
            <default>admin</default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter>
            <name>tomcatpass</name>
            <title>Tomcat Administrator Password</title>
            <description>Tomcat Administrator Password</description>
            <explanation>Now I need a password for the Tomcat Administrator...</explanation>
            <value></value>
            <default></default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter>
            <name>tomcatport</name>
            <title>Tomcat Port</title>
            <description>Tomcat Port</description>
            <explanation>What port number do you want Tomcat to listen to? This will be the port that you will use to access both Tomcat's Web Administrator and OpenBD's Web Administrator. If you're not sure what this is, just leave it set to it's default value.</explanation>
            <value>8888</value>
            <default>8888</default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>6</width>
            <validationActionList>
                <throwError>
                    <text>Unable to bind to the given port number. Please select another one.</text>
                    <ruleList>
                        <portTest>
                            <condition>cannot_bind</condition>
                            <port>${tomcatport}</port>
                        </portTest>
                    </ruleList>
                </throwError>
            </validationActionList>
        </stringParameter>
        <stringParameter>
            <name>systemuser</name>
            <title>Tomcat System User</title>
            <description>Tomcat System User</description>
            <explanation>The Tomcat System User is the system user that Tomcat will run as. Running as "root" will avoid system permission problems, while running as a non-root user will add an additional layer of security. It is recommended to use "railo" or "openbd" as the non-root user so it will be easy to identify and use.</explanation>
            <value></value>
            <default>root</default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>30</width>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </stringParameter>
        <stringParameter>
            <name>openbdpass</name>
            <title>OpenBD Administrator Password</title>
            <description>OpenBD Administrator Passowrd</description>
            <explanation>OpenBD comes with a web-based administrator that allows you to control how your instance of OpenBD performs.  Please enter a secure password that you will use to access your OpenBD Administrator below.</explanation>
            <value></value>
            <default></default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <booleanParameter>
            <name>startatboot</name>
            <title>Start At Boot?</title>
            <description>Yes, Start OpenBD at Boot Time</description>
            <explanation>Do you want OpenBD to start up automatically whenever the system boots up?</explanation>
            <value></value>
            <default>yes</default>
            <displayStyle>checkbox-left</displayStyle>
        </booleanParameter>
        <booleanParameter>
            <name>installconn</name>
            <title>Install Apache Connector?</title>
            <description>Install Apache Connector?</description>
            <explanation>The Apache connector is needed for most installs. The only time it is not needed is if you are not using Apache as your primary web server. If you're not sure what to do here, please install the connector.</explanation>
            <value></value>
            <default>yes</default>
            <displayStyle>checkbox-left</displayStyle>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </booleanParameter>
        <choiceParameter>
            <name>apachever</name>
            <title>Apache Version Number</title>
            <description>Apache Version Number</description>
            <explanation>Please select the version of Apache that is running on your computer.</explanation>
            <value></value>
            <default>22</default>
            <allowEmptyValue>0</allowEmptyValue>
            <displayType>combobox</displayType>
            <ordering>default</ordering>
            <width>30</width>
            <optionList>
                <option>
                    <description></description>
                    <image></image>
                    <text>Apache 2.2</text>
                    <value>22</value>
                </option>
                <option>
                    <description></description>
                    <image></image>
                    <text>Apache 2.0</text>
                    <value>20</value>
                </option>
                <option>
                    <description></description>
                    <image></image>
                    <text>Apache 1.3</text>
                    <value>13</value>
                </option>
            </optionList>
            <ruleList>
                <isTrue>
                    <value>${installconn}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </choiceParameter>
        <fileParameter>
            <name>apachecontrolloc</name>
            <title>Apache Control Script Location</title>
            <description>Apache Control Script Location</description>
            <explanation>Please enter the location of your apache control script. The default location for this script is "/etc/init.d/httpd" in CentOS and "/etc/init.d/apache2" in Ubuntu.</explanation>
            <value></value>
            <default>${apachecontrolloc}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>0</mustBeWritable>
            <mustExist>1</mustExist>
            <width>30</width>
            <ruleList>
                <isTrue>
                    <value>${installconn}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </fileParameter>
        <directoryParameter>
            <name>apachemodulesloc</name>
            <title>Apache Modules Directory</title>
            <description>Apache Modules Directory</description>
            <explanation>Please enter the directory that apache stores it's modules in. By default, this directory is located at "/usr/lib/httpd/modules/" for RHEL/CentOS, and "/usr/lib/apache2/modules/" for Ubuntu. For 64-bit systems, try changing the "lib" directory to "lib64".</explanation>
            <value></value>
            <default>${apachemodulesloc}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>1</mustExist>
            <width>30</width>
            <ruleList>
                <isTrue>
                    <value>${installconn}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </directoryParameter>
        <fileParameter>
            <name>apacheconfigloc</name>
            <title>Apache Configuration File</title>
            <description>Apache Configuration File</description>
            <explanation>The Apache configuration file controls how Apache processes incoming requests. The default location of the Apache configurtion file is "/etc/httpd/conf/httpd.conf" on RHEL/CentOS and "/etc/apache2/apache2.conf" on Ubuntu.</explanation>
            <value>${apacheconfigloc}</value>
            <default></default>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>1</mustExist>
            <width>30</width>
            <ruleList>
                <isTrue>
                    <value>${installconn}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </fileParameter>
        <directoryParameter>
            <name>apachelogloc</name>
            <title>Apache Logs Directory</title>
            <description>Apache Logs Directory</description>
            <explanation>Please enter the directory that apache stores it's log files in. By default, this directory is located at "/var/log/httpd/" for RHEL/CentOS, and "/var/log/apache2/" for Ubuntu. The installer needs this to properly install the Apache-Tomcat connector (mod_jk).</explanation>
            <value></value>
            <default>${apachelogloc}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>1</mustExist>
            <width>30</width>
            <ruleList>
                <isTrue>
                    <value>${installconn}</value>
                </isTrue>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </directoryParameter>
        <booleanParameter>
            <name>installiis</name>
            <title>Install the ${iis_version} Connector?</title>
            <description>Install the ${iis_version} Connector?</description>
            <explanation>Do you want to install the ${iis_version} Connector? If you're unsure, leave this box checked.</explanation>
            <value>yes</value>
            <default>yes</default>
            <displayStyle>checkbox-left</displayStyle>
            <preShowPageActionList>
                <setInstallerVariable>
                    <name>installiis</name>
                    <value>yes</value>
                </setInstallerVariable>
                <showWarning>
                    <progressText>Detecting ISAPI Extensions</progressText>
                    <text>IIS "ISAPI Extensions" is not installed.

You may still attempt the IIS connection, but it will almost certainly not work without this module installed.</text>
                    <ruleList>
                        <registryTest>
                            <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\InetStp\Components\</key>
                            <logic>does_not_exist</logic>
                            <name>ISAPIExtensions</name>
                            <wowMode>64</wowMode>
                        </registryTest>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS7</value>
                        </compareText>
                    </ruleList>
                </showWarning>
                <showWarning>
                    <progressText>Detecting ISAPI Filters</progressText>
                    <text>IIS "ISAPI Filters" is not installed.

You may still attempt the IIS connection, but it will almost certainly not work without this module installed.</text>
                    <ruleList>
                        <registryTest>
                            <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\InetStp\Components\</key>
                            <logic>does_not_exist</logic>
                            <name>ISAPIFilter</name>
                            <wowMode>64</wowMode>
                        </registryTest>
                        <compareText>
                            <logic>equals</logic>
                            <text>${iis_version}</text>
                            <value>IIS7</value>
                        </compareText>
                    </ruleList>
                </showWarning>
            </preShowPageActionList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </booleanParameter>
        <choiceParameter>
            <name>bittype</name>
            <title>Choose Bit Type</title>
            <description>Bit Type</description>
            <explanation>Please verify the bit-type you're wanting to install. Are you running a 32-bit or a 64-bit OS?</explanation>
            <value>${bittype}</value>
            <default>${bittype}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <displayType>combobox</displayType>
            <insertAfter>apachever</insertAfter>
            <ordering>default</ordering>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <width>30</width>
            <optionList>
                <option>
                    <description>32-bit</description>
                    <image></image>
                    <text>32-bit</text>
                    <value>32</value>
                </option>
                <option>
                    <description>64-bit</description>
                    <image></image>
                    <text>64-bit</text>
                    <value>64</value>
                </option>
            </optionList>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </choiceParameter>
    </parameterList>
    <platformOptionsList>
        <platformOptions>
            <platform>linux</platform>
        </platformOptions>
        <platformOptions>
            <platform>linux-x64</platform>
        </platformOptions>
    </platformOptionsList>
</project>

